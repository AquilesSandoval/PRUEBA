# Arquitectura de Datos - Aplicaciรณn Deportiva

## Diagrama de Flujo de Datos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         BASE DE DATOS                            โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ          โ
โ  โ   Atletas    โ  โ   Informes   โ  โ    Planes    โ          โ
โ  โ              โ  โ              โ  โ              โ          โ
โ  โ - id         โ  โ - id         โ  โ - id         โ          โ
โ  โ - nombre     โ  โ - atleta_id  โ  โ - codigo     โ          โ
โ  โ - apellido   โ  โ - tipo       โ  โ - tipo       โ          โ
โ  โ - foto       โ  โ - fecha      โ  โ - fechas     โ          โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               โ Consulta SQL
                               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      BACKEND / API REST                          โ
โ                                                                  โ
โ  GET /api/informes/ergo/:id                                     โ
โ  โโ Consulta DB                                                 โ
โ  โโ Formatea segรบn data_format.md                              โ
โ  โโ Retorna JSON                                                โ
โ                                                                  โ
โ  {                                                               โ
โ    "informe": {                                                  โ
โ      "atleta": { "nombre": "...", "apellido": "..." },          โ
โ      "fecha": "2024-11-21",                                      โ
โ      ...                                                         โ
โ    },                                                            โ
โ    "composicion_corporal": { ... },                             โ
โ    "gasto_energetico_reposo": { ... },                          โ
โ    ...                                                           โ
โ  }                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               โ HTTP Request
                               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FRONTEND / JavaScript                         โ
โ                                                                  โ
โ  fetch('/api/informes/ergo/123')                                โ
โ    .then(response => response.json())                           โ
โ    .then(data => {                                              โ
โ                                                                  โ
โ      // Usar ejemplo_implementacion.js                          โ
โ      poblarInformeErgo(data);                                   โ
โ                                                                  โ
โ      // O manualmente:                                          โ
โ      document.getElementById('athlete-name').textContent =      โ
โ        data.informe.atleta.nombre;                              โ
โ                                                                  โ
โ      // Grรกficos:                                               โ
โ      Highcharts.chart('container', {                            โ
โ        series: data.grafica_prioridad.series                    โ
โ      });                                                         โ
โ    });                                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               โ DOM Manipulation
                               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   PLANTILLA HTML DINรMICA                        โ
โ                                                                  โ
โ  <strong id="athlete-name-metabolico"></strong>                 โ
โ                          โ Poblado con                          โ
โ  <strong id="athlete-name-metabolico">JOURDAN MENDIETA</strong>โ
โ                                                                  โ
โ  <label id="peso-corporal"></label>                             โ
โ                          โ Poblado con                          โ
โ  <label id="peso-corporal">63</label>                           โ
โ                                                                  โ
โ  <div id="container"></div>                                     โ
โ                          โ Renderizado con                      โ
โ  <div id="container">[Grรกfico Highcharts]</div>                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Estructura de Archivos del Proyecto

```
PRUEBA/
โ
โโโ ๐ data_format.md                    โ Especificaciรณn de JSON
โโโ ๐ PLANTILLAS_README.md              โ Guรญa de implementaciรณn
โโโ ๐ ejemplo_implementacion.js         โ Cรณdigo de referencia
โโโ ๐ RESUMEN_TRANSFORMACION.md        โ Este resumen
โโโ ๐ ARQUITECTURA.md                   โ Este archivo
โ
โโโ INFORMES/
โ   โโโ REPORTES/
โ       โโโ ๐ REPORTES.html             โ Lista de reportes
โ       โโโ ERGO/
โ       โ   โโโ ๐ ERGOESPIROMETRICO.html    โ Informe detallado
โ       โ   โโโ ๐ ERGOESPIROMETRICO.js      โ Grรกfico polar
โ       โโโ LACTATO/
โ           โโโ ๐ INFORME LACTATO.html      โ Informe lactato
โ
โโโ MACRO/
โ   โโโ ๐ MACROCICLO.html               โ Plan macrociclo
โโโ MESO/
โ   โโโ ๐ MESOCICLO.html                โ Plan mesociclo
โโโ MICRO/
    โโโ ๐ MICROSICLO.html               โ Plan microciclo
```

## Mapeo de Datos: DB โ JSON โ HTML

### Ejemplo: Composiciรณn Corporal

```
BASE DE DATOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ tabla: informes_ergo    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id: 123                 โ
โ atleta_id: 45           โ
โ peso_kg: 63             โ
โ estatura_cm: 171        โ
โ imc: 21.5               โ
โ porcentaje_grasa: 12    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ Backend formatea
         โผ
JSON (data_format.md)
{
  "composicion_corporal": {
    "peso_kg": 63,
    "estatura_cm": 171,
    "imc": 21.5,
    "porcentaje_grasa": 12,
    ...
  }
}
         โ
         โ JavaScript procesa
         โผ
HTML (ERGOESPIROMETRICO.html)
<div>
  Peso: <label id="peso-corporal">63</label> kg
</div>
<div>
  Estatura: <label id="estatura">171</label> cm
</div>
<div>
  IMC: <label id="imc">21.5</label>
</div>
```

## Flujo de Trabajo Completo

### 1๏ธโฃ Preparaciรณn de Base de Datos
```sql
-- Ejemplo de estructura de tabla
CREATE TABLE informes_ergo (
    id INT PRIMARY KEY,
    atleta_id INT,
    fecha DATE,
    peso_kg DECIMAL(5,2),
    estatura_cm INT,
    imc DECIMAL(4,1),
    ...
    FOREIGN KEY (atleta_id) REFERENCES atletas(id)
);
```

### 2๏ธโฃ Implementaciรณn de API

**Backend (Python/Flask):**
```python
@app.route('/api/informes/ergo/<int:id>')
def get_informe(id):
    informe = db.session.query(InformeErgo).get(id)
    atleta = informe.atleta
    
    # Formatear segรบn data_format.md
    return jsonify({
        "informe": {
            "id": informe.id,
            "atleta": {
                "nombre": atleta.nombre,
                "apellido": atleta.apellido,
                "foto": atleta.foto_url
            },
            "fecha": informe.fecha.isoformat()
        },
        "composicion_corporal": {
            "peso_kg": float(informe.peso_kg),
            "estatura_cm": informe.estatura_cm,
            "imc": float(informe.imc),
            ...
        },
        ...
    })
```

### 3๏ธโฃ Carga de Datos en Frontend

**JavaScript:**
```javascript
// Opciรณn A: Desde archivo de ejemplo
const poblarInformeErgo = async (id) => {
    const data = await fetch(`/api/informes/ergo/${id}`).then(r => r.json());
    
    // Usar funciรณn del ejemplo_implementacion.js
    poblarInformeErgo(data);
};

// Opciรณn B: Personalizado
const cargarYMostrar = async (id) => {
    const data = await fetch(`/api/informes/ergo/${id}`).then(r => r.json());
    
    // Informaciรณn bรกsica
    document.getElementById('athlete-name-metabolico').textContent = 
        `${data.informe.atleta.nombre} ${data.informe.atleta.apellido}`;
    
    // Composiciรณn corporal
    document.getElementById('peso-corporal').textContent = data.composicion_corporal.peso_kg;
    document.getElementById('estatura').textContent = data.composicion_corporal.estatura_cm;
    
    // Grรกfico
    Highcharts.chart('container', {
        series: data.grafica_prioridad.series
    });
};
```

## Ventajas de Esta Arquitectura

### โ Separaciรณn de Responsabilidades
- **Backend**: Lรณgica de negocio y acceso a datos
- **API**: Capa de comunicaciรณn estandarizada (JSON)
- **Frontend**: Presentaciรณn y experiencia de usuario

### โ Reutilizaciรณn
- Las plantillas HTML se reutilizan para cualquier atleta/informe
- El formato JSON es consistente y predecible
- El cรณdigo JavaScript se puede modularizar

### โ Mantenibilidad
- Cambios en el diseรฑo: solo modificar CSS y HTML
- Cambios en datos: solo modificar estructura JSON
- Cambios en lรณgica: solo modificar backend

### โ Escalabilidad
- Fรกcil agregar nuevos tipos de informes
- Posible implementar caching en API
- Frontend puede ser servido desde CDN

## Patrones de Diseรฑo Aplicados

### 1. Template Pattern
Las plantillas HTML son templates que se llenan con datos dinรกmicos.

### 2. MVC (Model-View-Controller)
- **Model**: Base de datos
- **View**: Plantillas HTML
- **Controller**: API Backend + JavaScript

### 3. RESTful API
Endpoints siguen convenciones REST:
- `GET /api/informes/ergo/:id` - Obtener un informe
- `GET /api/informes/lactato/:id` - Obtener informe de lactato
- `GET /api/planes/macro/:id` - Obtener macrociclo

### 4. Data Transfer Object (DTO)
El JSON sirve como DTO entre backend y frontend.

## Extensibilidad Futura

### Posibles Mejoras

**Backend:**
- โจ Agregar autenticaciรณn JWT
- โจ Implementar caching con Redis
- โจ Crear endpoints para actualizar datos
- โจ Versionado de API (v1, v2)

**Frontend:**
- โจ Implementar Progressive Web App (PWA)
- โจ Agregar offline mode con Service Workers
- โจ Optimizar carga con lazy loading
- โจ Agregar internacionalizaciรณn (i18n)

**Datos:**
- โจ Agregar validaciones con JSON Schema
- โจ Implementar GraphQL como alternativa
- โจ Crear sistema de plantillas de informes

## Checklist de Implementaciรณn

- [ ] Diseรฑar schema de base de datos segรบn data_format.md
- [ ] Crear modelos ORM (SQLAlchemy, Django ORM, etc.)
- [ ] Implementar endpoints de API REST
- [ ] Validar respuestas JSON contra especificaciรณn
- [ ] Implementar funciones de poblado en frontend
- [ ] Probar con datos reales
- [ ] Optimizar rendimiento
- [ ] Documentar API (Swagger/OpenAPI)
- [ ] Configurar CI/CD
- [ ] Desplegar a producciรณn

## Recursos Adicionales

- **Highcharts Docs**: https://www.highcharts.com/docs/
- **Bootstrap**: https://getbootstrap.com/docs/
- **REST API Best Practices**: https://restfulapi.net/
- **JSON Schema**: https://json-schema.org/

---

**Estado**: โ Arquitectura definida y documentada  
**Siguiente paso**: Implementar backend API segรบn esta especificaciรณn
